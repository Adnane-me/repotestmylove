name: Push to Khadija Repo - Diagnostic

on:
  push:
    branches:
      - main  # ou la branche que tu veux surveiller

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout le repo, sans persister les credentials
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      # 2Ô∏è‚É£ Configurer Git (nom et email)
      - name: Configure Git
        run: |
          git config --global user.email "Adnane.Mehdaoui@usmba.ac.ma"
          git config --global user.name "Adnane-me"

      # 3Ô∏è‚É£ V√©rifier que le secret TEST est pr√©sent
      - name: Check Secret
        run: |
          if [ -z "${{ secrets.TEST }}" ]; then
            echo "‚ùå Secret TEST is empty"
            exit 1
          else
            echo "‚úÖ Secret TEST is present"
          fi

      # 4Ô∏è‚É£ Ajouter le remote et pousser
      - name: Test Push to Khadija
        env:
          GH_TOKEN: ${{ secrets.TEST }}
        run: |
          # Supprime remote si d√©j√† pr√©sent
          git remote remove khadija || true

          # Ajoute le remote avec PAT et x-access-token
          git remote add khadija https://x-access-token:${GH_TOKEN}@github.com/khadijaelmaaroufi/testadnankhadija.git

          # V√©rifie l'acc√®s
          echo "üîπ Test d'acc√®s au repo de Khadija"
          git ls-remote khadija

          # Push sur main
          echo "üîπ Tentative de push"
          git push khadija main --force
