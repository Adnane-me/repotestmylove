name: Push to Khadija Repo - Diagnostic
on:
  push:
    branches:
      - main

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Configure Git
        run: |
          git config --global user.email "Adnane.Mehdaoui@usmba.ac.ma"
          git config --global user.name "Adnane-me"

      - name: Check Secret
        run: |
          if [ -z "${{ secrets.TEST }}" ]; then
            echo "‚ùå Secret TEST is empty"
            exit 1
          else
            echo "‚úÖ Secret TEST is present"
          fi

      - name: Test Push to Khadija
        env:
          GH_TOKEN: ${{ secrets.TEST }}
        run: |
          # Supprime remote si existant
          git remote remove khadija || true
          # Ajoute remote avec token
          git remote add khadija https://Adnane-me:${GH_TOKEN}@github.com/khadijaelmaaroufi/testadnankhadija.git
          
          echo "üîπ Test d'acc√®s au repo de Khadija"
          git ls-remote khadija || echo "‚ùå Impossible d'acc√©der au repo : v√©rifie le token et permissions"

          echo "üîπ Tentative de push"
          git push khadija main --force || echo "‚ùå Push √©chou√© : v√©rifie le token et que le repo est accessible"
